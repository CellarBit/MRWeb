<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Game</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
            background-color: #f4f4f9;
            font-family: Arial, sans-serif;
            margin: 0;
        }
        h1 {
            margin-bottom: 20px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            gap: 0;
            border: 2px solid #000;
            width: 90vw;
            max-width: 720px; /* Adjust for larger screens */
        }
        .cell {
            position: relative;
            width: 100%;
            padding-top: 100%; /* Creates a 1:1 aspect ratio */
            text-align: center;
            border: 1px solid #000;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }
        .cell input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            background-color: transparent;
            box-sizing: border-box;
            transition: font-size 0.2s ease;
            font-size:  calc(1.5rem + 1.4vw); /* Default font size based on viewport */
        }
        .cell input:focus {
            outline: none;
        }
        .cell input[readonly] {
            background-color: #e6e6e6;
        }
        .cell:nth-child(3n+1) {
            border-left: 2px solid #000;
        }
        .cell:nth-child(n+1):nth-of-type(-n+9) {
            border-top: 2px solid #000;
        }
        .cell:nth-child(3n) {
            border-right: 2px solid #000;
        }
        .cell:nth-child(n+19):nth-of-type(-n+27),
        .cell:nth-child(n+46):nth-of-type(-n+54),
        .cell:nth-child(n+73):nth-of-type(-n+81) {
            border-bottom: 3px solid #000;
        }
        .controls {
            margin-top: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ddd;
            text-align: center; /* Center the text */
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

    </style>
</head>
<body>
    <h1>Sudoku Game</h1>
    <div class="grid" id="sudokuGrid"></div>
    <div class="controls">
        <label for="filledCells">Number of filled cells (from 25 to 80):</label>
        <input type="number" id="filledCells" min="25" max="80" value="26">
        <br><br>
        <button onclick="generatePuzzle(); startTimer();">Generate Puzzle</button>
        <button onclick="validatePuzzle()">Validate Puzzle</button>
        <button onclick="FilledSeventeen(); startTimer()">17 filled cell</button>
        <br><br>
        <label for="solutionCount">Number of possible solutions:</label>
        <span id="solutionCount">0</span>
    </div>
    <div id="playerStatistics">
        <table>
            <thead>
                <tr>
                    <th>Given Cells</th>
                    <th>Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="statisticsBody">
                <!-- Player statistics will be displayed here -->
            </tbody>
        </table>
    </div>
    
    
    
    <script>
        const sudokuPuzzles = [

        [
            [0, 0, 0, 0, 0, 0, 0, 1, 2],
            [0, 0, 0, 0, 3, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 4, 0, 9],
            [1, 0, 0, 0, 0, 0, 6, 0, 0],
            [0, 0, 0, 5, 0, 0, 0, 0, 8],
            [0, 0, 0, 0, 0, 8, 0, 0, 7],
            [9, 0, 4, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 6, 0],
            [3, 6, 0, 1, 0, 0, 0, 0, 0]
        ]
           //can add more puzzles here     

        ];
        document.getElementById('solutionCount').textContent = '';

        function generatePuzzle() {
            const sudokuBoard = Array.from({ length: 9 }, () => Array(9).fill(0));
            fillGrid(sudokuBoard);

            const numHoles = 81 - parseInt(document.getElementById('filledCells').value);
            removeNumbers(sudokuBoard, numHoles);

            const grid = document.getElementById('sudokuGrid');
            grid.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    const input = createInputElement(sudokuBoard[i][j], sudokuBoard[i][j]);
                    cell.appendChild(input);
                    grid.appendChild(cell);
                }
            }

            // Count and display the number of possible solutions
            const solutionCount = countSolutions(sudokuBoard);
            document.getElementById('solutionCount').textContent = solutionCount;
        }

        function FilledSeventeen() {
            const randomIndex = Math.floor(Math.random() * sudokuPuzzles.length);
            const selectedPuzzle = sudokuPuzzles[randomIndex];
            const grid = document.getElementById('sudokuGrid');
            grid.innerHTML = '';

            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    const input = createInputElement(selectedPuzzle[i][j], selectedPuzzle[i][j]);
                    cell.appendChild(input);
                    grid.appendChild(cell);
                }
            }
        }

        function createInputElement(value, readOnly) {
            const input = document.createElement('input');
            input.type = 'tel';
            input.maxLength = 4; // Max length 1 to allow only single digit numbers
            input.pattern = "[1-9]";
            input.inputmode = "numeric"; // Ensure numeric keyboard on mobile devices
            input.value = value ? value : '';
            input.oninput = combinedOnInput;
            if (readOnly) {
                input.readOnly = true;
                input.style.backgroundColor = '#e6e6e6';
            }
            input.placeholder = '';
            return input;
        }

        function combinedOnInput(event) {
            adjustFontSize(event);
            validateInput(event);
        }

        function adjustFontSize(event) {
            const input = event.target;
            const maxFontSize = 1.5; // Maximum font size in rem
            const minFontSize = 0.2; // Minimum font size in rem
            const maxLength = 5; // Maximum character count for maximum font size
            const characterCount = input.value.length;

            // Calculate the font size
            let fontSize = maxFontSize - (characterCount / maxLength) * (maxFontSize - minFontSize);
            fontSize = Math.max(fontSize, minFontSize); // Ensure font size is not below min

            input.style.fontSize = `calc(${fontSize}rem + ${2*fontSize / maxFontSize}vw)`; // Adjust font size based on viewport
        }




        function validateInput(event) {
            const input = event.target;
            input.value = input.value.replace(/[^1-9]/g, ''); // Allow only digits from 1 to 9
        }

        function isValid(board, row, col, num) {
            for (let i = 0; i < 9; i++) {
                if ((board[row][i] === num && i !== col) || (board[i][col] === num && i !== row)) {
                    return false;
                }
            }
            const startRow = 3 * Math.floor(row / 3);
            const startCol = 3 * Math.floor(col / 3);
            for (let i = startRow; i < startRow + 3; i++) {
                for (let j = startCol; j < startCol + 3; j++) {
                    if (board[i][j] === num && (i !== row || j !== col)) {
                        return false;
                    }
                }
            }
            return true;
        }

        function fillGrid(board) {
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    if (board[i][j] === 0) {
                        const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                        numbers.sort(() => Math.random() - 0.5);
                        for (const num of numbers) {
                            if (isValid(board, i, j, num)) {
                                board[i][j] = num;
                                if (fillGrid(board)) {
                                    return true;
                                }
                                board[i][j] = 0;
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        function removeNumbers(board, numHoles) {
            let count = numHoles;
            while (count > 0) {
                const row = Math.floor(Math.random() * 9);
                const col = Math.floor(Math.random() * 9);
                if (board[row][col] != 0) {
                    const temp = board[row][col];
                    board[row][col] = 0;

                    // Check if the puzzle still has a unique solution
                    if (countSolutions(board) !== 1) {
                        board[row][col] = temp;
                    } else {
                        count--;
                    }
                }
            }
        }

        function validatePuzzle() {
            const grid = document.getElementById('sudokuGrid');
            const cells = grid.getElementsByTagName('input');
            const board = Array.from({ length: 9 }, () => Array(9).fill(0));
            let valid = true;

            for (let i = 0; i < 81; i++) {
                const row = Math.floor(i / 9);
                const col = i % 9;
                const value = cells[i].value ? parseInt(cells[i].value) : 0;

                if (cells[i].value.length > 1 || value === 0 || !isValid(board, row, col, value)) {
                    valid = false;
                    cells[i].style.backgroundColor = 'red';
                } else {
                    cells[i].style.backgroundColor = '';
                }

                board[row][col] = value;
            }

            if (valid) {
                const { minutes, seconds } = stopTimer();
                alert(`Solved in ${minutes} minutes and ${seconds} seconds`);

                // Get the number of filled cells from the input element
                const filledCellsCount = parseInt(document.getElementById('filledCells').value);

                // Store statistics in local storage
                const solvedGames = JSON.parse(localStorage.getItem('solvedGames')) || [];
                solvedGames.push({
                    filledCells: filledCellsCount,
                    time: `${minutes} min, ${seconds} sec`
                });
                localStorage.setItem('solvedGames', JSON.stringify(solvedGames));
                
                // Update statistics display
                displayStatistics();
            } else {
                alert('There are errors in the puzzle. Please correct them.');
            }
        }


        function countSolutions(board) {
            let solutionCount = 0;
            function solve(board) {
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        if (board[i][j] === 0) {
                            for (let num = 1; num <= 9; num++) {
                                if (isValid(board, i, j, num)) {
                                    board[i][j] = num;
                                    solve(board);
                                    board[i][j] = 0;
                                }
                            }
                            return;
                        }
                    }
                }
                solutionCount++;
            }
            solve(board);
            return solutionCount;
        }

        let startTime;
        let endTime;

        function startTimer() {
            startTime = new Date();
        }

        function stopTimer() {
            endTime = new Date();
            const timeDiff = endTime - startTime; // in ms
            const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60)); // Fixed calculation
            return {minutes, seconds};
        }

        function displayStatistics() {
            const solvedGames = JSON.parse(localStorage.getItem('solvedGames')) || [];
            const statisticsBody = document.getElementById('statisticsBody');
            statisticsBody.innerHTML = ''; // Clear previous statistics

            solvedGames.forEach((game, index) => {
                const row = document.createElement('tr');
                const givenCellsCell = document.createElement('td');
                const timeCell = document.createElement('td');
                const deleteCell = document.createElement('td');

                givenCellsCell.textContent = game.filledCells;
                timeCell.textContent = game.time;

                // Create delete button
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'x';
                deleteButton.className = 'deleteButton';
                deleteButton.addEventListener('click', function() {
                    deleteStatistic(index);
                });

                deleteCell.appendChild(deleteButton);

                row.appendChild(givenCellsCell);
                row.appendChild(timeCell);
                row.appendChild(deleteCell);
                statisticsBody.appendChild(row);
            });
        }

         // Function to delete a specific statistic
        function deleteStatistic(index) {
            const solvedGames = JSON.parse(localStorage.getItem('solvedGames')) || [];
            solvedGames.splice(index, 1); // Remove the item at the specified index
            localStorage.setItem('solvedGames', JSON.stringify(solvedGames)); // Update local storage
            displayStatistics(); // Refresh the statistics display
        }

        // Call displayStatistics on page load to show previous results
        displayStatistics();


    </script>
</body>
</html>