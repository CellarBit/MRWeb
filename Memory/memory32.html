<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Memory Game</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .card {
        width: 11vw;  /* Responsive size using percentage */
        height: 11vw; /* Responsive size using percentage */
        background-color: lightgray;
        display: inline-block;
        margin: 0;  /* Ensure no unwanted margins */
        text-align: center;
        cursor: pointer;
        background-image: url('facedown.png');
        background-size: cover;
        /* max-width: 100px; 
        max-height: 100px;  */
      
    }

    .matched {
      background-color: lightgreen;
    }

    #game-board {
      display: grid;
      grid-template-rows: repeat(4, 1fr); /*  rows */
      grid-template-columns: repeat(8, 1fr);  /*  columns */
      gap: 0;  /* Reduced gap */
      box-sizing: border-box; 
      overflow: hidden;  /* Prevent overflow */
      
    }


    @media screen and (max-width: 600px) and (orientation:portrait) {
      .card {
        width: 21vw;
        height: 21vw;
       
      }

      #game-board {
        grid-template-columns: repeat(4, 1fr);  /* 4 columns */
        grid-template-rows: repeat(8, 1fr); /* 6 rows */
        width: 84vw;
      }
    }

      #fullscreen-button {
          position: fixed;
          bottom: 10px;
          right: 10px;
          padding: 10px 15px;
          font-size: 16px;
          background-color: #559c03;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
      }

          
  </style>
</head>
<body>
  <div id="game-board"></div>
  <button id="fullscreen-button">FullScreen</button>
  <script>
    const imagePath = 'images/';
    const faceDownImage = 'facedown.png';
    const cardsArray = [...Array(16).keys()].flatMap(x => [x, x]);
    let firstCard = null;
    let secondCard = null;
    let matches = 0;

    function preloadImages(images, callback) {
      let loadedImages = 0;
      const totalImages = images.length;

      images.forEach(src => {
        const img = new Image();
        img.src = src;
        img.onload = () => {
          loadedImages += 1;
          if (loadedImages === totalImages) {
            callback();
          }
        };
        img.onerror = () => {
          console.error(`Failed to load image: ${src}`);
        };
      });
    }

    function createCard(value) {
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.value = value;
      card.dataset.flipped = 'false';
      card.style.backgroundImage = `url(${imagePath}${faceDownImage})`;
      card.addEventListener('click', handleCardClick);
      return card;
    }

    function handleCardClick(event) {
      const card = event.target;
      const finish = new Audio('JurassicSong.mp3');
      if (firstCard && secondCard) return;
      if (card.dataset.flipped === 'true') return;

      if (!firstCard) {
        firstCard = card;
        flipCard(card);
      } else if (card !== firstCard && !secondCard) {
        secondCard = card;
        flipCard(card);

        if (firstCard.dataset.value === secondCard.dataset.value) {
          firstCard.classList.add('matched');
          secondCard.classList.add('matched');
          firstCard = null;
          secondCard = null;
          matches += 1;
          if (matches === cardsArray.length / 2) {
            
            setTimeout(() => {
              finish.play();
              finish.onended = () => {
                alert('You won!');
                location.reload();
              };
            }, 2000);
          }
        } else {
          setTimeout(() => {
            unflipCard(firstCard);
            unflipCard(secondCard);
            firstCard = null;
            secondCard = null;
          }, 1000);
        }
      }
    }


    function flipCard(card) {
      card.dataset.flipped = 'true';
      card.style.backgroundImage = `url(${imagePath}img${parseInt(card.dataset.value) + 1}.png)`;
    }

    function unflipCard(card) {
      card.dataset.flipped = 'false';
      card.style.backgroundImage = `url(${imagePath}${faceDownImage})`;
    }

    function initializeGame() {
      const gameBoard = document.getElementById('game-board');
      const shuffledArray = cardsArray.sort(() => 0.5 - Math.random());
      shuffledArray.forEach(value => {
        gameBoard.appendChild(createCard(value));
      });
    }

            // Add the event listener for the fullscreen button
            document.getElementById('fullscreen-button').addEventListener('click', () => {
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.mozRequestFullScreen) { // Firefox
                document.documentElement.mozRequestFullScreen();
            } else if (document.documentElement.webkitRequestFullscreen) { // Chrome, Safari, and Opera
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) { // IE/Edge
                document.documentElement.msRequestFullscreen();
            }
        });

        // Add the event listener for the fullscreen change
        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                document.getElementById('fullscreen-button').style.display = 'none';
            } else {
                document.getElementById('fullscreen-button').style.display = 'block';
            }
        });

        document.addEventListener('mozfullscreenchange', () => { // Firefox
            if (document.mozFullScreenElement) {
                document.getElementById('fullscreen-button').style.display = 'none';
            } else {
                document.getElementById('fullscreen-button').style.display = 'block';
            }
        });

        document.addEventListener('webkitfullscreenchange', () => { // Chrome, Safari, and Opera
            if (document.webkitFullscreenElement) {
                document.getElementById('fullscreen-button').style.display = 'none';
            } else {
                document.getElementById('fullscreen-button').style.display = 'block';
            }
        });

        document.addEventListener('msfullscreenchange', () => { // IE/Edge
            if (document.msFullscreenElement) {
                document.getElementById('fullscreen-button').style.display = 'none';
            } else {
                document.getElementById('fullscreen-button').style.display = 'block';
            }
        });


    const imagesToPreload = cardsArray.map(value => `${imagePath}img${value + 1}.png`).concat(`${imagePath}${faceDownImage}`);

    preloadImages(imagesToPreload, initializeGame);
  </script>
</body>
</html>
